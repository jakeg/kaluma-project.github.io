<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- prismjs -->
<link href="https://unpkg.com/prismjs@1.20.0/themes/prism.css" rel="stylesheet">

<!-- bootstrap-js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<!-- jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- google fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- main.css -->
<link rel="stylesheet" href="/styles/main.css">
    <title>Kaluma</title>
  </head>
  <body>
    <nav class="doc-sidebar">
      <div class="doc-sidebar-header p-3 border-bottom">
        <a href="/"><img src="/images/kaluma-logo.png" width="32px"></a>
        <span class="ms-2 fw-bold">Kaluma Docs</span>
      </div>
      <aside class="doc-sidebar-nav">
        <nav class="navbar-collapse collapse collapse-horizontal show" id="docs-nav">
          <ul class="list-unstyled">
            
              <li>
                <a href="/docs/">Introduction</a>
              </li>
            
              <li>
                <a href="/docs/getting-started/">Getting Started</a>
              </li>
            
              <li>
                <a href="/docs/repl/">REPL</a>
              </li>
            
            <li>
              <a href="https://github.com/kaluma-project/examples" target="_blank">Examples</a>
            </li>
            <br>
            <div class="doc-section">Boards</div>
            
              <li>
                <a href="/docs/boards/rp2/">RP2 (Raspberry Pi Pico)</a>
              </li>
            
            <br>
            <div class="doc-section">API</div>
            
              <li>
                <a href="/docs/api/adc/">ADC</a>
              </li>
            
              <li>
                <a href="/docs/api/analog-io/">Analog I/O</a>
              </li>
            
              <li>
                <a href="/docs/api/at-command/">AT Command</a>
              </li>
            
              <li>
                <a href="/docs/api/board/">Board</a>
              </li>
            
              <li>
                <a href="/docs/api/button/">Button</a>
              </li>
            
              <li>
                <a href="/docs/api/console/">Console</a>
              </li>
            
              <li>
                <a href="/docs/api/device-driver/">Device Driver</a>
              </li>
            
              <li>
                <a href="/docs/api/digital-io/">Digital I/O</a>
              </li>
            
              <li>
                <a href="/docs/api/errors/">Errors</a>
              </li>
            
              <li>
                <a href="/docs/api/events/">Events</a>
              </li>
            
              <li>
                <a href="/docs/api/file-system/">File system</a>
              </li>
            
              <li>
                <a href="/docs/api/flash/">Flash</a>
              </li>
            
              <li>
                <a href="/docs/api/global/">Global</a>
              </li>
            
              <li>
                <a href="/docs/api/gpio/">GPIO</a>
              </li>
            
              <li>
                <a href="/docs/api/graphics/">Graphics</a>
              </li>
            
              <li>
                <a href="/docs/api/http/">HTTP</a>
              </li>
            
              <li>
                <a href="/docs/api/i2c/">I2C</a>
              </li>
            
              <li>
                <a href="/docs/api/interrupts/">Interrupts</a>
              </li>
            
              <li>
                <a href="/docs/api/led/">LED</a>
              </li>
            
              <li>
                <a href="/docs/api/net/">Net</a>
              </li>
            
              <li>
                <a href="/docs/api/path/">Path</a>
              </li>
            
              <li>
                <a href="/docs/api/process/">Process</a>
              </li>
            
              <li>
                <a href="/docs/api/pwm/">PWM</a>
              </li>
            
              <li>
                <a href="/docs/api/rp2/">RP2</a>
              </li>
            
              <li>
                <a href="/docs/api/rtc/">RTC</a>
              </li>
            
              <li>
                <a href="/docs/api/spi/">SPI</a>
              </li>
            
              <li>
                <a href="/docs/api/storage/">Storage</a>
              </li>
            
              <li>
                <a href="/docs/api/stream/">Stream</a>
              </li>
            
              <li>
                <a href="/docs/api/timers/">Timers</a>
              </li>
            
              <li>
                <a href="/docs/api/uart/">UART</a>
              </li>
            
              <li>
                <a href="/docs/api/url/">URL</a>
              </li>
            
              <li>
                <a href="/docs/api/wifi/">Wi-Fi</a>
              </li>
            
          </ul>
        </nav>
      </aside>
    </nav>
    <div class="doc-body">
      <!-- <div class="text-end p-3 border-bottom"> v1.0 <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#docs-nav" aria-expanded="false">=</button> </div> -->
      <main class="container d-flex justify-content-center markdown-content" style="padding-bottom: 5rem;">
        <div style="width: 100%">
          <h1 id="at-command" tabindex="-1">AT Command <a class="direct-link" href="#at-command">#</a></h1>
<blockquote>
<p><strong>THIS IS EXPERIMENTAL AND SUBJECT OF CHANGE</strong></p>
</blockquote>
<p>The <code>at</code> module supports sending AT commands and handling the responses. This module is useful for the devices controlled by AT command such as Wi-Fi, GSM, Bluetooth modules. Use <code>require('at')</code> to access this module.</p>
<h2 id="class-atcommand" tabindex="-1">Class: ATCommand <a class="direct-link" href="#class-atcommand">#</a></h2>
<p>An instances of <code>ATCommand</code> represents a AT command handler. This class is a subclass of <a href="/docs/api/events"><code>EventEmitter</code></a>.</p>
<h3 id="new-atcommand" tabindex="-1">new ATCommand(uart[, options]) <a class="direct-link" href="#new-atcommand">#</a></h3>
<ul>
<li><strong><code>uart</code></strong> <code>&lt;UART&gt;</code> UART object where a device is connected which controlled by AT command.</li>
<li><strong><code>options</code></strong> <code>&lt;object&gt;</code> 
<ul>
<li><strong><code>debug</code></strong> <code>&lt;boolean&gt;</code> Print all data received from UART if <code>true</code>.</li>
</ul>
</li>
</ul>
<p>Create a AT command handler.</p>
<blockquote>
<p>Note that data received from <code>uart</code> is converted to an ASCII string (1 byte to 1 char) for easy manipulation.</p>
</blockquote>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Create an UART instance</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">UART</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> serial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UART</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">baudrate</span><span class="token operator">:</span> <span class="token number">115200</span><span class="token punctuation">,</span> <span class="token literal-property property">bufferSize</span><span class="token operator">:</span> <span class="token number">4096</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Create ATCommand instance</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span>ATCommand<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'at'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> at <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ATCommand</span><span class="token punctuation">(</span>serial<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>at<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'AT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// ...</span></code></pre>
<h3 id="at-send" tabindex="-1">at.send(cmd[, cb[, waitFor[, options]]) <a class="direct-link" href="#at-send">#</a></h3>
<ul>
<li><strong><code>cmd</code></strong> <code>&lt;string|Uint8Array&gt;</code> AT command (or data) to send. If <code>Uint8Array</code> type is given, it send as data.</li>
<li><strong><code>cb</code></strong> <code>&lt;function(result:string)&gt;</code> Callback called when expected response is arrived.
<ul>
<li><strong><code>result</code></strong> <code>&lt;string&gt;</code> Result status. One of array items of <code>match</code> parameter or <code>'TIMEOUT'</code> or <code>undefined</code>.</li>
</ul>
</li>
<li><strong><code>waitFor</code></strong> <code>&lt;number|Array&lt;string&gt;&gt;</code> Indicates what is expected response of the AT command. If a number of given, waits for the given time in milliseconds. <strong>Default:</strong> <code>['OK', 'ERROR', 'FAIL']</code></li>
<li><strong><code>options</code></strong> <code>&lt;object&gt;</code>
<ul>
<li><strong><code>timeout</code></strong> <code>&lt;number&gt;</code> Timeout for waiting response. <strong>Default:</strong> <code>10000</code> (10 sec). When timeout, callback is called with <code>'TIMEOUT'</code> for the second parameter.</li>
<li><strong><code>sendAsData</code></strong> <code>&lt;boolean&gt;</code> If <code>true</code>, <code>cmd</code> is sent as data without appending <code>'\r\n'</code> in the end. <strong>Default:</strong> <code>false</code>.</li>
</ul>
</li>
</ul>
<p>Sends AT command and wait for expected response. If you didn't provide parameters other than <code>cmd</code>, it sends AT command and then process the next command in the queue without waiting for expected response.</p>
<pre class="language-javascript"><code class="language-javascript">at<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'AT+XXX'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// send AT command and do not wait for response</span></code></pre>
<p>If you need to get response, provide <code>callback</code> and <code>match</code> parameters. If a number is given for <code>match</code> parameter, <code>callback</code> is called with the response just after waiting response for the given number of time (milliseconds).</p>
<pre class="language-javascript"><code class="language-javascript">at<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'AT+XXX'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// wait 1 sec for response</span></code></pre>
<p>If an array of string is given for the <code>match</code> parameter, <code>callback</code> is called with the response and the matched item in the <code>match</code> parameter when there is a line matched with the <code>match</code> parameter in the response buffer.</p>
<pre class="language-javascript"><code class="language-javascript">at<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'AT+XXX'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">===</span> <span class="token string">'OK'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DONE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'OK'</span><span class="token punctuation">,</span> <span class="token string">'ERROR'</span><span class="token punctuation">,</span> <span class="token string">'FAIL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="at-addhandler" tabindex="-1">at.addHandler(match, handler) <a class="direct-link" href="#at-addhandler">#</a></h3>
<ul>
<li><strong><code>match</code></strong> <code>&lt;string&gt;</code> A match string.</li>
<li><strong><code>handler</code></strong> <code>&lt;Function&gt;</code> Handler function.
<ul>
<li><code>line</code> <code>&lt;string&gt;</code> The matched line.</li>
<li><code>buffer</code> <code>&lt;string&gt;</code> The response buffer.</li>
</ul>
</li>
</ul>
<p>Add a handler. If there is a line starts with the <code>match</code> parameter in the response buffer, the handler function will be called. The data from start to the matched line are removed from the response buffer. If you want to keep the response buffer without any changes, then just return <code>false</code>.</p>
<pre class="language-javascript"><code class="language-javascript">at<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span><span class="token string">'WIFI DISCONNECTED'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Wifi disconnected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If the handler is not enough to handle just the matched line, you can manipulate the entire response buffer by returning the handled data.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Handle +IPD response of ESP8266</span><br><span class="token comment">// e.g.) "+IPD,11:Hello,World"</span><br>at<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span><span class="token string">'+IPD,'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">line<span class="token punctuation">,</span> buffer</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// if received all data in buffer</span><br>    <span class="token keyword">var</span> data <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> remained <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> remained<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// if not received all data in buffer</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="at-removehandler" tabindex="-1">at.removeHandler(match) <a class="direct-link" href="#at-removehandler">#</a></h3>
<ul>
<li><strong><code>match</code></strong> <code>{string}</code> </li>
</ul>
<p>Remove a line handler.</p>
<pre class="language-javascript"><code class="language-javascript">at<span class="token punctuation">.</span><span class="token function">addLineHandler</span><span class="token punctuation">(</span><span class="token string">'WIFI DISCONNECTED'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Wifi disconnected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>at<span class="token punctuation">.</span><span class="token function">removeLineHandler</span><span class="token punctuation">(</span><span class="token string">'WIFI DISCONNECTED'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="at-buffer" tabindex="-1">at.buffer <a class="direct-link" href="#at-buffer">#</a></h3>
<ul>
<li><code>{string}</code></li>
</ul>
<p>Response buffer for the responses of AT commands.</p>

        </div>
      </main>
    </div>
  </body>
</html>